version: '3.5'

services:
  go:
    build:
      # set the build-context of this Dockerfile
      context: ./backend/
      dockerfile: Dockerfile
    links:
      - mongo
  angular:
    build: 
      # set the build-context of this Dockerfile
      context: ./frontend/
      dockerfile: Dockerfile
    volumes:
      # the volume needs path to /frontend/ again, because build-context only sets context for the Dockerfile
      - './frontend/:/usr/src/app'
      # this anonymous volume prevents the node_modules from being overwritten
      - '/usr/src/app/node_modules'
  mongo:
    image: mongo:latest
    ports:
      - 27017:27017
    volumes:
      - ./database/storage:/data/db
  nginx:
      build:
        # set the build-context of this Dockerfile
        context: ./nginx/
        dockerfile: Dockerfile
      ports:
        - 80:80
      links:
      - go
      - angular
