<mat-toolbar [color]="'accent'">Gruppen-Manager</mat-toolbar>

<main *ngIf="$persons | async as persons; else loading">
  <ng-container *ngFor="let person of persons">
    <form
      [formGroup]="person.form"
      (ngSubmit)="
        onSubmit(person.id, person.form.get('confirmed').value, person.form.get('groups').value, person.name, person.form)
      "
    >
      <mat-toolbar>
        <span>{{ person.name }}</span>
        <div class="content-spacer"></div>
        <mat-spinner *ngIf="person.form.disabled" [color]="'accent'" [diameter]="36"></mat-spinner>
        <button
          mat-flat-button
          [color]="'primary'"
          type="submit"
          [disabled]="person.form.invalid || !person.form.dirty || person.form.disabled"
        >
          <mat-icon>save</mat-icon>SPEICHERN
        </button>
      </mat-toolbar>
      <mat-checkbox formControlName="confirmed">Best√§tigtes Mitglied</mat-checkbox>

      <mat-form-field>
        <mat-chip-list #chipList formControlName="groups">
          <mat-chip *ngFor="let group of this.person.form.get('groups').value" (removed)="removeGroup(group, person.form)">
            {{ group }}
            <mat-icon matChipRemove>cancel</mat-icon>
          </mat-chip>
          <input
            placeholder="Gruppen"
            [matChipInputFor]="chipList"
            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
            (matChipInputTokenEnd)="addGroup($event, person.form)"
          />
        </mat-chip-list>
      </mat-form-field>
    </form>
  </ng-container>
  <mat-paginator
    [pageSize]="10"
    [pageIndex]="pageIndex"
    [hidePageSize]="true"
    [length]="$count | async"
    (page)="onPage($event)"
  ></mat-paginator>
</main>

<ng-template #loading>
  <mat-progress-bar [color]="'accent'" [mode]="'indeterminate'"></mat-progress-bar>
</ng-template>
